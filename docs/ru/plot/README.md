# Модуль plot - Графики и визуализация

Модуль `plot` предоставляет функциональность для работы с изображениями, их отображения в окнах, а также построения различных типов графиков и диаграмм в ДатаКод.

## Импорт модуля

Модуль `plot` доступен как глобальная переменная после импорта:

```datacode
import plot
```

## Работа с изображениями

### `plot.image(path) -> Image | null`

Загружает изображение из файла по указанному пути.

**Параметры:**
- `path` (строка): путь к файлу изображения

**Возвращает:**
- `Image`: объект изображения при успешной загрузке
- `null`: если загрузка не удалась

**Пример:**
```datacode
let img = plot.image("путь/к/изображению.png")
if img != null {
    print("Изображение загружено!")
} else {
    print("Ошибка загрузки изображения")
}
```

**Поддерживаемые форматы:**
- PNG (.png)
- JPEG (.jpg, .jpeg)
- GIF (.gif)
- BMP (.bmp)
- И другие форматы, поддерживаемые библиотекой `image` в Rust

### `plot.window(width, height, title) -> Window | null`

Создает новое окно для отображения графики.

**Параметры:**
- `width` (число): ширина окна в пикселях
- `height` (число): высота окна в пикселях
- `title` (строка): заголовок окна

**Возвращает:**
- `Window`: объект окна при успешном создании
- `null`: если создание не удалось

**Пример:**
```datacode
let окно = plot.window(800, 600, "Мое окно")
if окно != null {
    print("Окно создано успешно")
}
```

### `plot.draw(window, image) -> null`

Рисует изображение в указанном окне.

**Параметры:**
- `window` (Window): объект окна
- `image` (Image): объект изображения

**Возвращает:**
- `null`: всегда возвращает null

**Пример:**
```datacode
let окно = plot.window(800, 600, "Просмотр")
let изображение = plot.image("image.png")
if окно != null && изображение != null {
    plot.draw(окно, изображение)
}
```

### `plot.wait(window) -> null`

Блокирует выполнение программы до закрытия окна пользователем.

**Параметры:**
- `window` (Window): объект окна

**Возвращает:**
- `null`: всегда возвращает null

**Пример:**
```datacode
let окно = plot.window(800, 600, "Ожидание")
plot.wait(окно)
print("Окно закрыто")
```

### `plot.show(path) -> null`
### `plot.show(figure, title="...") -> null`
### `plot.show(title="...") -> null`

Удобная функция для быстрого просмотра изображения или фигуры. Автоматически загружает изображение, создает окно с размерами изображения, отображает его и ждет закрытия. Также может отображать фигуру с subplots или текущий график.

**Параметры:**
- `path` (строка, опционально): путь к файлу изображения
- `figure` (Figure, опционально): объект фигуры с subplots
- `title` (строка, опционально): заголовок окна

**Возвращает:**
- `null`: всегда возвращает null

**Примеры:**
```datacode
# Показать изображение из файла
plot.show("путь/к/изображению.png")

# Показать фигуру с subplots
fig = plot.subplots(2, 2)
# ... настройка subplots ...
plot.show(fig, title="Моя фигура")

# Показать текущий график с заголовком
plot.bar(x, y)
plot.show(title="Мой график")
```

## Работа с subplots

### `plot.subplots(rows, cols, figsize=(width, height)) -> Figure`

Создает фигуру с сеткой subplots для отображения нескольких графиков одновременно.

**Параметры:**
- `rows` (число): количество строк в сетке
- `cols` (число): количество столбцов в сетке
- `figsize` (кортеж, опционально): размер фигуры в дюймах (ширина, высота), по умолчанию (10, 10)

**Возвращает:**
- `Figure`: объект фигуры с двумерным массивом осей `axes[row][col]`

**Пример:**
```datacode
# Создать сетку 3x3
fig = plot.subplots(3, 3, figsize=(10, 10))

# Доступ к осям
axis = fig.axes[0][0]  # Первая ось (верхний левый угол)
axis = fig.axes[1][2]  # Ось во второй строке, третьем столбце
```

### `plot.tight_layout(figure) -> null`

Автоматически настраивает отступы между subplots для более аккуратного отображения.

**Параметры:**
- `figure` (Figure): объект фигуры

**Возвращает:**
- `null`: всегда возвращает null

**Пример:**
```datacode
fig = plot.subplots(2, 2)
# ... настройка subplots ...
plot.tight_layout(fig)
plot.show(fig)
```

## Методы объекта Axis

Объект `Axis` получается через `fig.axes[row][col]` из объекта `Figure`.

### `axis.imshow(image, cmap='gray') -> null`

Отображает изображение в оси.

**Параметры:**
- `image` (Image | Tensor): изображение для отображения
- `cmap` (строка, опционально): цветовая карта ('gray', 'viridis' и др.), по умолчанию 'gray'

**Возвращает:**
- `null`: всегда возвращает null

**Пример:**
```datacode
fig = plot.subplots(1, 1)
axis = fig.axes[0][0]
let img = plot.image("image.png")
if img != null {
    axis.imshow(img, cmap='gray')
}
plot.show(fig)
```

### `axis.set_title(title) -> null`

Устанавливает заголовок для оси.

**Параметры:**
- `title` (строка): текст заголовка

**Возвращает:**
- `null`: всегда возвращает null

**Пример:**
```datacode
axis.set_title("Мое изображение")
```

### `axis.axis('off') -> null`
### `axis.axis('on') -> null`

Управляет видимостью координатных осей.

**Параметры:**
- `mode` (строка): 'off' для скрытия осей, 'on' для показа

**Возвращает:**
- `null`: всегда возвращает null

**Пример:**
```datacode
axis.axis('off')  # Скрыть оси
axis.axis('on')   # Показать оси
```

## Построение графиков

### `plot.bar(x, y) -> null`

Создает столбчатую диаграмму (bar chart).

**Параметры:**
- `x` (массив строк): категории для оси X
- `y` (массив чисел): значения для оси Y

**Возвращает:**
- `null`: всегда возвращает null

**Пример:**
```datacode
x = ["Категория 1", "Категория 2", "Категория 3"]
y = [10, 20, 15]
plot.xlabel("Категория")
plot.ylabel("Значение")
plot.bar(x, y)
plot.show(title="Столбчатая диаграмма")
```

### `plot.line(x, y, connected, color) -> null`

Создает линейный график (line chart).

**Параметры:**
- `x` (массив чисел): значения для оси X
- `y` (массив чисел): значения для оси Y
- `connected` (булево): соединять ли точки линией
- `color` (строка, опционально): цвет линии

**Возвращает:**
- `null`: всегда возвращает null

**Поддерживаемые цвета:**
- Именованные цвета: `"blue"`, `"green"`, `"red"`, `"black"`, `"white"`
- Hex-коды: например, `"#a434eb"`

**Пример:**
```datacode
x = [1, 2, 3, 4, 5]
y = [2, 4, 1, 6, 3]
y1 = [7, 12, 2, 9, 1]

plot.xlabel("Время")
plot.ylabel("Значение")

plot.line(x, y, true, color="blue")
plot.line(x, y1, true, color="green")
plot.show(title="Линейный график")
```

### `plot.pie(x, y) -> null`

Создает круговую диаграмму (pie chart).

**Параметры:**
- `x` (массив строк): метки для секторов
- `y` (массив чисел): значения для секторов

**Возвращает:**
- `null`: всегда возвращает null

**Пример:**
```datacode
x = ["Элемент 1", "Элемент 2", "Элемент 3"]
y = [30, 40, 30]
plot.pie(x, y)
plot.show(title="Круговая диаграмма")
```

### `plot.heatmap(data, min, max, palette) -> null`

Создает тепловую карту (heatmap) из матрицы данных.

**Параметры:**
- `data` (массив массивов чисел): двумерный массив данных
- `min` (число, опционально): минимальное значение для цветовой шкалы
- `max` (число, опционально): максимальное значение для цветовой шкалы
- `palette` (строка, опционально): цветовая палитра (например, "red")

**Возвращает:**
- `null`: всегда возвращает null

**Пример:**
```datacode
data = [
  [1, 2, 3, 4, 5],
  [2, 4, 6, 8, 10],
  [3, 6, 9, 12, 15]
]

# Базовое использование
plot.heatmap(data)
plot.show(title="Тепловая карта")

# С настройкой диапазона
plot.heatmap(data, min=0, max=100)
plot.show(title="Тепловая карта с диапазоном")

# С выбором палитры
plot.heatmap(data, palette="red")
plot.show(title="Тепловая карта красная")
```

## Настройка осей

### `plot.xlabel(label) -> null`

Устанавливает подпись для оси X.

**Параметры:**
- `label` (строка): текст подписи

**Возвращает:**
- `null`: всегда возвращает null

**Пример:**
```datacode
plot.xlabel("Время")
plot.bar(x, y)
plot.show()
```

### `plot.ylabel(label) -> null`

Устанавливает подпись для оси Y.

**Параметры:**
- `label` (строка): текст подписи

**Возвращает:**
- `null`: всегда возвращает null

**Пример:**
```datacode
plot.ylabel("Значение")
plot.line(x, y, true)
plot.show()
```

## Типы данных

### Image

Объект изображения, содержащий:
- Данные пикселей в формате RGBA
- Ширину изображения
- Высоту изображения

### Window

Объект окна, содержащий:
- Размеры окна (ширина, высота)
- Заголовок окна
- Состояние окна (открыто/закрыто)

### Figure

Объект фигуры с subplots, содержащий:
- Двумерный массив осей `axes[row][col]`
- Размер фигуры `figsize` (ширина, высота)
- Настройки компоновки

### Axis

Объект оси для отображения графиков, содержащий:
- Изображение для отображения
- Заголовок оси
- Настройки видимости координатных осей
- Цветовую карту (cmap)

## Важные моменты

1. **Пути к файлам**: Используйте правильные пути к файлам изображений. Относительные пути указываются относительно текущей директории выполнения программы.

2. **Блокирующие функции**: Функции `plot.show()` и `plot.wait()` блокируют выполнение программы до закрытия окна пользователем.

3. **Проверка результатов**: Всегда проверяйте результат загрузки изображения и создания окна на `null`, чтобы обработать возможные ошибки.

4. **Центрирование**: Изображение автоматически центрируется в окне, если оно меньше размера окна.

5. **Последовательность операций**: При построении графиков сначала настройте оси (`plot.xlabel()`, `plot.ylabel()`), затем постройте график (`plot.bar()`, `plot.line()` и т.д.), и в конце вызовите `plot.show()` для отображения.

6. **Множественные графики**: Можно построить несколько графиков на одной оси, вызвав функции построения несколько раз перед `plot.show()`.

## Примеры использования

### Полный пример работы с изображениями

```datacode
import plot

# Загрузка изображения
let img = plot.image("image.png")
if img == null {
    print("Ошибка загрузки изображения")
    exit(1)
}

# Создание окна
let окно = plot.window(1024, 768, "Просмотр изображения")
if окно == null {
    print("Ошибка создания окна")
    exit(1)
}

# Отображение изображения
plot.draw(окно, img)

# Ожидание закрытия окна
plot.wait(окно)
print("Окно закрыто")
```

### Пример работы с subplots

```datacode
import plot, ml

# Создание сетки 2x2
fig = plot.subplots(2, 2, figsize=(10, 10))

# Загрузка данных
data = ml.load_mnist("test")
images = []
for x, y in data {
    push(images, x)
    if len(images) >= 4 {
        break
    }
}

# Заполнение subplots
for i in range(4) {
    row = i // 2
    col = i % 2
    axis = fig.axes[row][col]
    axis.imshow(images[i], cmap='gray')
    axis.set_title("Изображение " + str(i))
    axis.axis('off')
}

# Настройка отступов и отображение
plot.tight_layout(fig)
plot.show(fig, title="Пример subplots")
```

### Пример построения различных графиков

```datacode
import plot

# Столбчатая диаграмма
x = ["Сыр", "Молоко", "Овощи", "Фрукты", "Вода"]
y = [2, 4, 1, 6, 3]
plot.xlabel("Категория")
plot.ylabel("Значение")
plot.bar(x, y)
plot.show(title="Столбчатая диаграмма")

# Линейный график
x = [1, 2, 3, 4, 5]
y = [2, 4, 1, 6, 3]
y1 = [7, 12, 2, 9, 1]
plot.xlabel("Время")
plot.ylabel("Значение")
plot.line(x, y, true, color="blue")
plot.line(x, y1, true, color="green")
plot.show(title="Линейный график")

# Круговая диаграмма
x = ["Сыр", "Молоко", "Овощи", "Фрукты", "Вода"]
y = [2, 4, 1, 6, 3]
plot.pie(x, y)
plot.show(title="Круговая диаграмма")

# Тепловая карта
data = [
  [1, 2, 3, 4, 5],
  [2, 4, 6, 8, 10],
  [3, 6, 9, 12, 15]
]
plot.heatmap(data)
plot.show(title="Тепловая карта")
```

## См. также

- [Примеры использования модуля plot](../../../examples/ru/10-графики/)
- [Встроенные функции](../builtin_functions.md)
- [Типы данных](../data_types.md)

