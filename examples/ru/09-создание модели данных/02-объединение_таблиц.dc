# –ü—Ä–∏–º–µ—Ä 2: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
# –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü –≤ –æ–¥–Ω—É —Å –ø–æ–º–æ—â—å—é merge_tables()

print("============================================================")
print("–ü—Ä–∏–º–µ—Ä 2: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü")
print("============================================================")
print()

# –ü—Ä–∏–º–µ—Ä 2.1: –ë–∞–∑–æ–≤–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
print("üîç –ü—Ä–∏–º–µ—Ä 2.1: –ë–∞–∑–æ–≤–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü...")

# –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Ç–∞–±–ª–∏—Ü —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
let table1 = table([
    [1, "Alice", 25],
    [2, "Bob", 30]
], ["id", "name", "age"])

let table2 = table([
    [3, "Charlie", 35],
    [4, "David", 28]
], ["id", "name", "age"])

let table3 = table([
    [5, "Eve", 32]
], ["id", "name", "age"])

print("  –¢–∞–±–ª–∏—Ü–∞ 1: ", len(table1), " —Å—Ç—Ä–æ–∫")
print("  –¢–∞–±–ª–∏—Ü–∞ 2: ", len(table2), " —Å—Ç—Ä–æ–∫")
print("  –¢–∞–±–ª–∏—Ü–∞ 3: ", len(table3), " —Å—Ç—Ä–æ–∫")
print()

# –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã
let merged = merge_tables(tables=[table1, table2, table3], mode="outer")

if merged != null {
    print("  ‚úì –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞: ", len(merged), " —Å—Ç—Ä–æ–∫")
    print("  ‚úì –ó–∞–≥–æ–ª–æ–≤–∫–∏: ", merged.columns)
} else {
    print("  ‚úó –û—à–∏–±–∫–∞: –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–∞–≤–Ω–∞ null")
}
print()

# –ü—Ä–∏–º–µ—Ä 2.2: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏–∑ —Ñ–∞–π–ª–æ–≤
print("üîç –ü—Ä–∏–º–µ—Ä 2.2: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–æ–≤...")
try {
    let base_path = getcwd() / "model_data"
    
    # –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–¥–∞–∂ –ø–æ –º–µ—Å—è—Ü–∞–º
    let sales_tables = []
    
    # –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª 2023 –≥–æ–¥–∞
    for month in ["01", "02", "03"] {
        let file_path = base_path / "2023" / month / ("sales_2023_" + month + ".csv")
        try {
            let data = read_file(file_path)
            sales_tables = push(sales_tables, data)
            print("  ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ sales_2023_", month, ".csv: ", len(data), " —Å—Ç—Ä–æ–∫")
        } catch e {
            print("  ‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å sales_2023_", month, ".csv: ", e)
        }
    }
    
    print()
    
    # –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–æ–¥–∞–∂
    if len(sales_tables) > 0 {
        let all_sales = merge_tables(sales_tables)
        if all_sales != null {
            print("  ‚úì –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–∂: ", len(all_sales), " —Å—Ç—Ä–æ–∫ –≤—Å–µ–≥–æ")
            print("  ‚úì –ó–∞–≥–æ–ª–æ–≤–∫–∏: ", all_sales.columns)
        }
    }
    print()
} catch e {
    print("  ‚úó –û—à–∏–±–∫–∞: ", e)
    print()
}

# –ü—Ä–∏–º–µ—Ä 2.3: –ö—Ä–∞–µ–≤—ã–µ —Å–ª—É—á–∞–∏
print("üîç –ü—Ä–∏–º–µ—Ä 2.3: –ö—Ä–∞–µ–≤—ã–µ —Å–ª—É—á–∞–∏...")

# –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
let empty_merged = merge_tables([])
if empty_merged == null {
    print("  ‚úì merge_tables([]) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç null (–æ–∂–∏–¥–∞–µ–º–æ)")
} else {
    print("  ‚úó –û—à–∏–±–∫–∞: merge_tables([]) –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å null")
}

# –û–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞
let single_merged = merge_tables([table1])
if single_merged != null and len(single_merged) == len(table1) {
    print("  ‚úì merge_tables([single_table]) —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ: ", len(single_merged), " —Å—Ç—Ä–æ–∫")
} else {
    print("  ‚úó –û—à–∏–±–∫–∞: merge_tables([single_table]) –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª")
}
print()

print("============================================================")
print("‚úÖ –ü—Ä–∏–º–µ—Ä 2 –∑–∞–≤–µ—Ä—à—ë–Ω")
print("============================================================")
