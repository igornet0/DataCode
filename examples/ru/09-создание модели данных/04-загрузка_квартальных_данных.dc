# –ü—Ä–∏–º–µ—Ä 4: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
# –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ —Å–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

print("============================================================")
print("–ü—Ä–∏–º–µ—Ä 4: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö")
print("============================================================")
print()

let base_path = getcwd() / "model_data"

print("üìÇ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–ª–æ–∂–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π")
print("  –ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å: ", base_path)
print()

# –°–æ–±—Ä–∞—Ç—å –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ —Å–≤–æ–¥–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
let all_financial_summary = []
let all_regional_summary = []
let all_product_summary = []
let all_employee_performance = []

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø–æ –≥–æ–¥–∞–º
let year_dirs = list_files(base_path)
print("  –ù–∞–π–¥–µ–Ω–æ ", len(year_dirs), " —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–æ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏")
print()

# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π –≥–æ–¥
for year_dir in year_dirs {
    # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã, –Ω–µ —è–≤–ª—è—é—â–∏–µ—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏
    if year_dir.name != "docs" and !contains(year_dir.name, ".") {        
        # –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø–æ –º–µ—Å—è—Ü–∞–º
        let month_dirs = list_files(year_dir)
        
        # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü
        for month_dir in month_dirs {
            if !contains(month_dir.name, ".") {
                
                # –ü–æ–ª—É—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –º–µ—Å—è—Ü–∞
                let month_items = list_files(month_dir)
                
                # –ò—Å–∫–∞—Ç—å –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (quarter_YYYY_QN)
                for item in month_items {
                    if contains(item.name, "quarter_") {
                        
                        print("  üìÅ –ù–∞–π–¥–µ–Ω–∞ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: ", item)
                        
                        # –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª—ã –≤ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                        try {
                            let quarter_files = list_files(item)
                            
                            # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
                            for quarter_file in quarter_files {
                                try {
                                    let data = read_file(quarter_file)
                                    
                                    # –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ø–æ —à–∞–±–ª–æ–Ω—É –∏–º–µ–Ω–∏
                                    if contains(quarter_file.name, "financial_summary_") {
                                        all_financial_summary = push(all_financial_summary, data)
                                        print("    ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ financial_summary: ", quarter_file.name)
                                    }
                                    
                                    if contains(quarter_file.name, "regional_summary_") {
                                        all_regional_summary = push(all_regional_summary, data)
                                        print("    ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ regional_summary: ", quarter_file.name)
                                    }
                                    
                                    if contains(quarter_file.name, "product_summary_") {
                                        all_product_summary = push(all_product_summary, data)
                                        print("    ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ product_summary: ", quarter_file.name)
                                    }
                                    
                                    if contains(quarter_file.name, "employee_performance_") {
                                        all_employee_performance = push(all_employee_performance, data)
                                        print("    ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ employee_performance: ", quarter_file.name)
                                    }
                                } catch e {
                                    print("    ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ", quarter_file.name, ": ", e)
                                }
                            }
                        } catch e {
                            print("    ‚ö†Ô∏è  –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: ", e)
                        }
                    }
                }
            }
        }
    }
}

print()
print("üìä –°–≤–æ–¥–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:")
print("  –§–∞–π–ª–æ–≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–≤–æ–¥–æ–∫: ", len(all_financial_summary))
print("  –§–∞–π–ª–æ–≤ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–≤–æ–¥–æ–∫: ", len(all_regional_summary))
print("  –§–∞–π–ª–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö —Å–≤–æ–¥–æ–∫: ", len(all_product_summary))
print("  –§–∞–π–ª–æ–≤ –æ—Ç—á—ë—Ç–æ–≤ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º: ", len(all_employee_performance))
print()

# –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
print("üîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü...")

let financial_summary_all = null
let regional_summary_all = null
let product_summary_all = null
let employee_performance_all = null

if len(all_financial_summary) > 0 {
    financial_summary_all = merge_tables(all_financial_summary)
    if financial_summary_all != null {
        print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω—ã —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–≤–æ–¥–∫–∏: ", len(financial_summary_all), " —Å—Ç—Ä–æ–∫")
    }
}

if len(all_regional_summary) > 0 {
    regional_summary_all = merge_tables(all_regional_summary)
    if regional_summary_all != null {
        print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω—ã —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–≤–æ–¥–∫–∏: ", len(regional_summary_all), " —Å—Ç—Ä–æ–∫")
    }
}

if len(all_product_summary) > 0 {
    product_summary_all = merge_tables(all_product_summary)
    if product_summary_all != null {
        print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–µ —Å–≤–æ–¥–∫–∏: ", len(product_summary_all), " —Å—Ç—Ä–æ–∫")
    }
}

if len(all_employee_performance) > 0 {
    employee_performance_all = merge_tables(all_employee_performance)
    if employee_performance_all != null {
        print("  ‚úì –û–±—ä–µ–¥–∏–Ω–µ–Ω—ã –æ—Ç—á—ë—Ç—ã –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º: ", len(employee_performance_all), " —Å—Ç—Ä–æ–∫")
    }
}
print()

print("============================================================")
print("‚úÖ –ü—Ä–∏–º–µ—Ä 4 –∑–∞–≤–µ—Ä—à—ë–Ω")
print("============================================================")
