// Байт-код инструкции для VM

#[derive(Debug, Clone, PartialEq)]
pub enum OpCode {
    // Константы
    Constant(usize), // Индекс в массиве констант

    // Локальные переменные
    LoadLocal(usize),  // Загрузить локальную переменную по индексу
    StoreLocal(usize), // Сохранить в локальную переменную по индексу

    // Глобальные переменные
    LoadGlobal(usize),  // Загрузить глобальную переменную по индексу
    StoreGlobal(usize), // Сохранить в глобальную переменную по индексу

    // Арифметические операции
    Add,
    Sub,
    Mul,
    Div,
    IntDiv, // Целочисленное деление (//)
    Mod, // Модуло (%)
    Pow, // Возведение в степень (**)
    Negate, // Унарный минус
    
    // Логические операции
    Not, // Унарный Bang (!)
    Or,  // Логическое ИЛИ (or)
    And, // Логическое И (and)

    // Операции сравнения
    Equal,
    Greater,
    Less,
    NotEqual,
    GreaterEqual,
    LessEqual,
    In, // Проверка наличия значения в массиве (value in array)

    // Управление потоком
    // Временные метки для этапа компиляции
    JumpLabel(usize),        // Временная метка для безусловного перехода (label_id)
    JumpIfFalseLabel(usize), // Временная метка для условного перехода (label_id)
    
    // Финальные инструкции с относительными смещениями
    Jump8(i8),          // Безусловный переход с 8-битным смещением [-128, +127]
    Jump16(i16),        // Безусловный переход с 16-битным смещением [-32768, +32767]
    Jump32(i32),        // Безусловный переход с 32-битным смещением [-2^31, +2^31-1]
    JumpIfFalse8(i8),   // Условный переход с 8-битным смещением [-128, +127]
    JumpIfFalse16(i16), // Условный переход с 16-битным смещением [-32768, +32767]
    JumpIfFalse32(i32), // Условный переход с 32-битным смещением [-2^31, +2^31-1]

    // Функции
    Call(usize), // Вызов функции с количеством аргументов
    Return,      // Возврат из функции

    // Массивы
    MakeArray(usize), // Создать массив из N элементов со стека (compile-time размер)
    MakeArrayDynamic, // Создать массив из N элементов со стека (runtime размер: N на стеке, затем N элементов)
    GetArrayLength,   // Получить длину массива
    GetArrayElement,  // Получить элемент массива по индексу (индекс и массив на стеке)
    Clone,            // Глубокое клонирование значения на стеке (для массивов и таблиц)
    
    // Кортежи
    MakeTuple(usize), // Создать кортеж из N элементов со стека (compile-time размер)
    
    // Объекты
    MakeObject(usize), // Создать объект из N пар (ключ, значение) со стека (compile-time количество пар)

    // Обработка исключений
    BeginTry(usize),        // Начало try блока, аргумент - индекс обработчика в таблице обработчиков
    EndTry,                 // Конец try блока
    Catch(Option<usize>),   // Начало catch блока, Option<usize> - тип ошибки (индекс в таблице типов), None для catch всех
    EndCatch,               // Конец catch блока
    Throw(Option<usize>),    // Выбрасывание исключения (для будущего использования), Option<usize> - тип ошибки
    PopExceptionHandler,     // Удаление обработчика исключений со стека

    // Стек
    Pop, // Удалить значение со стека

    // Модули
    Import(usize), // Импорт модуля (индекс имени модуля в константах)
    ImportFrom(usize, usize), // from-импорт: (индекс имени модуля, индекс массива элементов импорта в константах)
}

